# Мониторинг

Мониторинг включает в себя инфраструктурный слой для отслеживания основных базовых метрик процессов иправления памятью и вычислительными ресурсами; метрики реального времени для отслеживания качества отработки запросов к сервису; прикладной уровень для мониторинга работы самой модели предсказаний. Каждый слой включает по две метрики для всестороннего мониторинга. Прикладные уровни и соответствующие метрики объеденины в списки "row" для удобства

## Для мониторинга выбраны метрики нескольких слоев:

### Инфраструткурный слой:
- <CPU — rate(process_cpu_seconds_total[1m])>

Показывает загрузку CPU процессом сервиса в «ядрах/сек». Полезно для быстрого выявления перегруза и триггеров авто-масштабирования; устойчивое >0.8 ядра на vCPU часто коррелирует с ростом задержек

- <Memory (RSS) — process_resident_memory_bytes>
Отслеживает фактическую занятую память процесса. Нужна для раннего обнаружения утечек и рисков OOM-килла


### Метрики реального времени:

- <Latency p99 — histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket{path="/howmuch"}[1m])))>
99-й перцентиль конца-в-конец: «99% запросов быстрее X сек». Индикатор удобен для пиковой нагрузки; удобно держать, например, p99 < 300 мс или другого релевантного порога чтобы предусмотреть нештатные ситуации. Удобно настраивать Алерты при возникновении необходимости

- <Error rate 4xx % — sum(rate(http_requests_total{path="/howmuch",status_code=~"4.."}[5m])) / sum(rate(http_requests_total{path="/howmuch"}[5m]))>
Доля серверных ошибок; мгновенно показывает деградации. Отношение в данном случае удобно тем, что мы не мониторим абсолютное число ошибок, основываясь на размере нагрузки в целом

### Метрики прикладного уровня:

- <Inference p99 — histogram_quantile(0.99, sum by (le) (rate(model_inference_duration_seconds_bucket[1m])))>
Перцентиль времени именно инференса модели; помогает отделить где «модель тормозит» от «сеть/БД/приложение». Полезно для сравнения версий модели и поиска регрессий.

- <rate(model_predictions_total{result=~"ok|error"}[1m])>
Предсказания по исходам. Скорость предсказаний с разбивкой «успех/ошибка» на уровне модели. Видно частоту сбоев инференса/валидации внутри хендлера.
